<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hazƒ±r Etiketli GPT ‚Äì Tek Dosya</title>
<style>
  :root{
    --bg:#0b0f14; --panel:#0f172a; --line:#1e293b; --text:#e6eef6; --muted:#93a4b8;
    --acc:#22d3ee; --acc2:#34d399; --badge:#1f2937; --chip:#0b1320;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;color:var(--text);
    background:
      radial-gradient(1000px 700px at -10% -10%, rgba(34,211,238,.18), transparent 60%),
      radial-gradient(1000px 700px at 110% 110%, rgba(52,211,153,.16), transparent 60%),
      linear-gradient(180deg, #0a0f15, #0b1118);
    font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
  }
  .app{max-width:1180px;margin:0 auto;padding:18px}
  .card{background:rgba(15,23,42,.72);backdrop-filter:blur(8px);border:1px solid var(--line);
        border-radius:22px;box-shadow:0 30px 80px rgba(0,0,0,.45);overflow:hidden}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;
         padding:14px 16px;border-bottom:1px solid var(--line)}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:30px;height:30px;border-radius:10px;background:conic-gradient(from 120deg,#0ea5e9,#22c55e)}
  h1{font-size:16px;margin:0;letter-spacing:.3px}
  .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  select, input[type=text]{background:#0b1320;color:var(--text);border:1px solid #243247;border-radius:12px;padding:8px 10px;height:38px;outline:none}
  .btn{height:38px;border:1px solid #234;color:#052f2b;background:linear-gradient(180deg,#27e0cc,#1bc2b5);
       border-radius:12px;padding:0 12px;font-weight:700;cursor:pointer}
  .btn.sec{background:#0b1320;color:var(--text);border-color:#243247;font-weight:600}
  .btn.warn{background:#ef4444;border-color:#ef4444;color:#fff}
  .wrap{display:grid;grid-template-columns:1.2fr 1fr;gap:14px;padding:12px}
  /* Left: tags + search */
  .tags{border-right:1px solid var(--line)}
  .search{display:flex;gap:8px;align-items:center;margin:10px 0}
  .search input{flex:1}
  .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
  @media (min-width:1100px){ .grid{grid-template-columns:repeat(3,minmax(0,1fr));} }
  .tag{
    background:var(--chip);border:1px solid #223047;border-radius:14px;padding:10px;cursor:pointer;
    display:flex;gap:10px;align-items:flex-start;transition:transform .06s ease, background .2s;
    min-height:82px
  }
  .tag:hover{transform:translateY(-1px);background:#0d1626}
  .tag .ic{font-size:20px;line-height:1.2}
  .tag .txt{flex:1}
  .tag .title{font-weight:700;margin:0 0 4px 0}
  .tag .desc{color:var(--muted);font-size:13px;margin:0}
  .fav{margin-left:auto;background:#142032;border:1px solid #263b56;border-radius:10px;padding:2px 6px;font-size:12px;cursor:pointer}
  .fav.active{background:#0a2e27;color:#a7f3d0;border-color:#2a5}
  .hint{color:var(--muted);font-size:13px;margin:8px 0}
  /* Right: chat */
  #chat{height:62vh;overflow:auto;padding:12px}
  .msg{display:flex;gap:10px;margin:10px 0;align-items:flex-start}
  .b{flex:0 0 38px;height:38px;border-radius:10px;display:grid;place-items:center;background:#0b1320;border:1px solid #213047}
  .user .b{background:#18212f}.bot .b{background:#0b3b32;border-color:#0b3b32}
  .bubble{padding:10px 12px;border-radius:14px;max-width:78%;border:1px solid #1f2a3d;background:#0e1520}
  .user .bubble{background:#141c2a}.bot .bubble{background:#0a2e27;border-color:#0a3a33}
  .actions{margin-top:6px;display:flex;gap:6px}
  .action{font-size:12px;padding:4px 8px;border-radius:8px;border:1px solid #264;background:#0d1b1a;color:#a7f3d0;cursor:pointer}
  form{display:flex;gap:10px;padding:12px;border-top:1px solid var(--line);background:#0e1520}
  textarea{flex:1;min-height:44px;max-height:180px;resize:none;padding:12px;border-radius:14px;background:#0b1320;color:var(--text);border:1px solid #243247;outline:none}
  .send{min-width:120px}
  .muted{color:var(--muted)}
  .spin{display:inline-block;width:16px;height:16px;border:2px solid #a7f3d0;border-right-color:transparent;border-radius:50%;animation:spin .8s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}
  /* Modal */
  .modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(3,6,10,.66)}
  .modal.show{display:grid}
  .box{width:min(560px,92%);background:#0e1623;border:1px solid #203049;border-radius:16px;padding:16px}
  .box h2{margin:0 0 10px 0;font-size:18px}
  .row{display:flex;gap:10px;align-items:center;margin:10px 0}
  .row input[type=password]{flex:1;background:#0b1320;color:var(--text);border:1px solid #243247;border-radius:10px;padding:10px}
  .kbd{border:1px solid #2a3b55;background:#0b1320;color:#c3d5ea;border-radius:6px;padding:2px 6px}
</style>
</head>
<body>
<div class="app">
  <div class="card">
    <header>
      <div class="brand"><div class="logo"></div><h1>Hazƒ±r Etiketli GPT</h1></div>
      <div class="controls">
        <select id="model">
          <option value="gpt-4o-mini" selected>gpt-4o-mini</option>
          <option value="gpt-4o">gpt-4o</option>
          <option value="gpt-4.1-mini">gpt-4.1-mini</option>
        </select>
        <input id="system" type="text" placeholder="System: T√ºrk√ße, net, tablo/ba≈ülƒ±k kullan." />
        <button class="btn sec" id="keyBtn">API Anahtarƒ±</button>
        <button class="btn sec" id="clear">Sohbeti Temizle</button>
      </div>
    </header>

    <div class="wrap">
      <!-- LEFT -->
      <section class="tags">
        <div class="search">
          <input id="q" type="text" placeholder="Etiket ara (√∂rn: gramer, diyalog, i≈ü fikri)‚Ä¶" />
          <button class="btn sec" id="showFav">‚≠ê Favoriler</button>
        </div>
        <p class="hint">ƒ∞pucu: Etikete <strong>tek tƒ±k</strong> = hemen g√∂nder. <strong>Alt + tƒ±k</strong> = d√ºzenleyip g√∂nder.</p>
        <div id="grid" class="grid"></div>
      </section>

      <!-- RIGHT -->
      <section>
        <div id="chat" aria-live="polite"></div>
        <form id="form">
          <textarea id="input" placeholder="ƒ∞stersen kendi mesajƒ±nƒ± da yazabilirsin‚Ä¶ (Enter = G√∂nder, Shift+Enter = Satƒ±r)"></textarea>
          <button class="btn send" id="send" type="submit">G√∂nder</button>
        </form>
        <p class="muted" style="margin:8px 2px 0">Not: Anahtar yerelde saklanƒ±r. √úretimde backend kullan.</p>
      </section>
    </div>
  </div>
</div>

<!-- API KEY MODAL -->
<div class="modal" id="modal">
  <div class="box">
    <h2>OpenAI API Anahtarƒ±</h2>
    <div class="row">
      <input id="key" type="password" placeholder="√∂r. sk-proj-................">
      <button class="btn" id="saveKey">Kaydet</button>
      <button class="btn sec" id="cancelKey">Kapat</button>
    </div>
    <div class="muted">Kƒ±sayol: <span class="kbd">Ctrl/Cmd</span> + <span class="kbd">Enter</span></div>
  </div>
</div>

<script>
/* ============= Yardƒ±mcƒ±lar ============= */
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));
const chat = $("#chat"), form = $("#form"), input = $("#input"), sendBtn = $("#send");
const modelSel = $("#model"), systemInput = $("#system");
const keyBtn = $("#keyBtn"), clearBtn = $("#clear");
const modal = $("#modal"), keyInput = $("#key"), saveKeyBtn = $("#saveKey"), cancelKeyBtn = $("#cancelKey");
const grid = $("#grid"), searchInput = $("#q"), favBtn = $("#showFav");

const LS_KEY = "openai_api_key";
const LS_FAVS = "ready_tags_favs";
const state = { messages: [] , showingFavs:false };

function esc(s){ return s.replace(/[&<>]/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[m])); }
function mdLite(t){ return esc(t).replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>").replace(/\*([^*]+)\*/g,"<em>$1</em>").replace(/\n/g,"<br>"); }
function cleanKey(k){ return (k||"").replace(/[^\x20-\x7E]/g,"").replace(/\s+/g,"").replace(/\.$/,""); }
function getKey(){ return cleanKey(localStorage.getItem(LS_KEY)||""); }
function setKey(k){ localStorage.setItem(LS_KEY, cleanKey(k)); }
function getFavs(){ try{return JSON.parse(localStorage.getItem(LS_FAVS)||"[]");}catch{return []} }
function toggleFav(id){ const f = new Set(getFavs()); f.has(id)?f.delete(id):f.add(id); localStorage.setItem(LS_FAVS, JSON.stringify([...f])); renderTags(); }

function addMsg(role, html, plain=""){
  const row = document.createElement("div");
  row.className = "msg " + (role==="user" ? "user" : "bot");
  row.innerHTML = `<div class="b">${role==="user"?"üë§":"ü§ñ"}</div><div class="bubble">${html}</div>`;
  if(role==="assistant"){
    const acts = document.createElement("div");
    acts.className = "actions";
    const cpy = document.createElement("button"); cpy.type="button"; cpy.className="action"; cpy.textContent="Kopyala";
    cpy.onclick=()=>navigator.clipboard.writeText(plain);
    acts.appendChild(cpy);
    row.lastElementChild.appendChild(acts);
  }
  chat.appendChild(row); chat.scrollTop = chat.scrollHeight;
  return row;
}
let typingEl=null; function showTyping(){ typingEl = addMsg("assistant", `<span class="spin"></span> Yazƒ±yor...`);} function hideTyping(){ if(typingEl){typingEl.remove(); typingEl=null;} }

/* ============= 25 Hazƒ±r Etiket ============= */
const TAGS = [
  {id:"idea",      ic:"üí°", title:"ƒ∞≈ü Fikri Yarat", desc:"Beceri/sermayeye g√∂re 3 √∂zg√ºn fikir + hƒ±zlƒ± doƒürulama adƒ±mlarƒ±.",
   prompt:`G√∂rev: 3 √∂zg√ºn i≈ü fikri √ºret. Girdi yoksa T√ºrkiye pazarƒ±nda mikro SaaS, hizmet ve i√ßerik tabanlƒ± karƒ±≈üƒ±k √∂ner.
Bi√ßim:
1) ƒ∞sim + tek c√ºmle
2) Neden ≈üimdi?
3) ƒ∞lk m√º≈üteri bulma
4) 1 haftalƒ±k MVP planƒ±
5) Ana risk & nasƒ±l test ederiz
Sƒ±nƒ±rlar: Uydurma rakam yazma; kƒ±sa, net, madde madde.`},

  {id:"mikrosaas", ic:"üß©", title:"Mikro SaaS Fikri", desc:"Ni≈ü bir acƒ±ya y√∂nelik 2 fikir + 1 ekran akƒ±≈üƒ±.",
   prompt:`G√∂rev: T√ºrkiye pazarƒ± i√ßin 2 mikro SaaS fikri ver. Her biri i√ßin (hedef, √ß√∂z√ºm, veri kaynaƒüƒ±, tek ekran akƒ±≈üƒ±).`},

  {id:"grammar_tr", ic:"üìù", title:"Gramer D√ºzelt (TR)", desc:"Metni dilbilgisi, noktalama ve akƒ±cƒ±lƒ±k i√ßin d√ºzelt.",
   prompt:`G√∂rev: A≈üaƒüƒ±daki T√ºrk√ße metni gramer/noktalama/akƒ±cƒ±lƒ±k y√∂n√ºyle d√ºzelt ve deƒüi≈üiklikleri i≈üaretli √∂zetle.
√áƒ±ktƒ±: 1) D√ºzeltilmi≈ü metin 2) Yapƒ±lan d√ºzeltmeler (madde madde) 3) 2 √∂neri.
Metin: [metni buraya yapƒ±≈ütƒ±r]`},

  {id:"grammar_en", ic:"‚úçÔ∏è", title:"Grammar Fix (EN)", desc:"Clear, concise, native-like rewrite + reasons.",
   prompt:`Task: Improve grammar, clarity, and tone of the following English text.
Output: 1) Polished text 2) Changes (bullet points) 3) Two style alternatives.
Text: [paste here]`},

  {id:"dialog_b1", ic:"üó£Ô∏è", title:"Diyalog Yaz (B1)", desc:"G√ºnl√ºk durum i√ßin 12-16 replik diyalog.",
   prompt:`G√∂rev: CEFR B1 seviyesinde, g√ºnl√ºk bir durumda (√∂r. ‚Äúalƒ±≈üveri≈üte iade‚Äù) 12‚Äì16 repliklik diyalog yaz.
Kural: Kƒ±sa c√ºmleler; deyim/kalƒ±p ekle; T√ºrk√ße √ßeviri verme; en sonda 8 kelimelik mini s√∂zl√ºk.`},

  {id:"dialog_b2", ic:"üí¨", title:"Diyalog Yaz (B2)", desc:"Tartƒ±≈üma tonu, 14‚Äì18 replik, arg√ºman‚Äìkar≈üƒ± arg√ºman.",
   prompt:`G√∂rev: CEFR B2 seviyesinde tartƒ±≈üma diyalogu yaz (14‚Äì18 replik). Arg√ºman‚Äìkar≈üƒ± arg√ºman i√ßersin; sonunda 5 tartƒ±≈üma sorusu.`},

  {id:"email_polish", ic:"üìß", title:"E-postayƒ± Profesyonelle≈ütir", desc:"Kƒ±sa, nazik, net; konu satƒ±rƒ± ve imza.",
   prompt:`G√∂rev: A≈üaƒüƒ±daki kaba e-postayƒ± profesyonel, kƒ±sa ve net hale getir. Konu satƒ±rƒ± ve kapanƒ±≈ü ekle.
Metin: [yapƒ±≈ütƒ±r]
Sƒ±nƒ±r: 120 kelimeyi ge√ßme; gereksiz √∂vg√º yok.`},

  {id:"sales_cold", ic:"üöÄ", title:"Soƒüuk Satƒ±≈ü E-postasƒ±", desc:"2 konu + 1 g√∂vde + CTA.",
   prompt:`G√∂rev: [√ºr√ºn/hizmet] i√ßin 2 konu satƒ±rƒ± ve 1 g√∂vde yaz. Hedef: [hedef kitle]. Ton: samimi ama net.
Bi√ßim: 1) Subject A 2) Subject B 3) Body (‚â§120 kelime) 4) CTA.`},

  {id:"linkedin_post", ic:"üîó", title:"LinkedIn G√∂nderisi", desc:"Kanca + deƒüer + kapanƒ±≈ü; 120‚Äì180 kelime.",
   prompt:`G√∂rev: [konu] hakkƒ±nda LinkedIn g√∂nderisi yaz. Yapƒ±: Kanca (1‚Äì2 c√ºmle) ‚Üí Deƒüer maddeleri ‚Üí Kapanƒ±≈ü/CTA.
Sƒ±nƒ±r: 120‚Äì180 kelime, emoji a≈üƒ±rƒ± kullanma.`},

  {id:"yt_outline", ic:"üé•", title:"YouTube Outline", desc:"Ba≈ülƒ±k, thumbnail metni, b√∂l√ºm akƒ±≈üƒ±.",
   prompt:`Task: Create a YouTube video outline for topic: [topic]. Include:
- 3 title options
- Thumbnail text (max 6 words)
- Hook (20s)
- Chapter flow with timestamps
- Call to action`},

  {id:"blog_outline", ic:"üß≠", title:"Blog Taslak (Outline)", desc:"H1‚ÄìH3 ba≈ülƒ±k planƒ±, brief ve kaynak fikirleri.",
   prompt:`G√∂rev: [ana konu] i√ßin blog taslaƒüƒ± olu≈ütur. √áƒ±ktƒ±:
- H1‚ÄìH3 ba≈ülƒ±k iskeleti
- Yazƒ±m brief'i (hedef kitle, ton, ama√ß)
- 6 alt konu ve olasƒ± g√∂rseller
- 5 SSS`},

  {id:"seo_clusters", ic:"üîé", title:"SEO K√ºmeleri", desc:"Kƒ±sa kuyruk ‚Üí konu k√ºmeleri + arama niyeti.",
   prompt:`G√∂rev: [anahtar kelime] i√ßin konu k√ºmeleri √ßƒ±kar. Her k√ºme: 1 ana sayfa + 4 alt yazƒ± fikri + arama niyeti + ba≈ülƒ±k √∂nerisi.`},

  {id:"product_desc", ic:"üõí", title:"E-ticaret √úr√ºn Metni", desc:"Kƒ±sa ba≈ülƒ±k + √∂zellikler + faydalar + SSS.",
   prompt:`G√∂rev: [√ºr√ºn] i√ßin √ºr√ºn sayfasƒ± metni yaz. √áƒ±ktƒ±: 1) Kƒ±sa ba≈ülƒ±k 2) 5 √∂zellik 3) 5 fayda 4) 3 SSS 5) Teknik tablo (markdown).`},

  {id:"complaint_reply", ic:"üõü", title:"≈ûik√¢yete Net Cevap", desc:"Empati + √ß√∂z√ºm + telafi; kƒ±sa.",
   prompt:`G√∂rev: A≈üaƒüƒ±daki m√º≈üteri ≈üik√¢yetine kƒ±sa, net ve empatik bir yanƒ±t yaz. Telafi ve net adƒ±m ekle.
≈ûik√¢yet: [yapƒ±≈ütƒ±r]
Yapƒ±: √ñz√ºr ‚Üí √á√∂z√ºm ‚Üí Takip/teslim tarihi ‚Üí ƒ∞leti≈üim.`},

  {id:"cv_summary", ic:"üßë‚Äçüíº", title:"CV √ñzet (LinkedIn)", desc:"Headline + About (‚â§180 kelime).",
   prompt:`G√∂rev: [deneyim/hedef] bilgime g√∂re LinkedIn ba≈ülƒ±k + 180 kelimelik About yaz. 6 anahtar beceri etiketi ekle.`},

  {id:"interview_q", ic:"üéØ", title:"M√ºlakat Soru&Cevap", desc:"Pozisyon √∂zel 6 soru, √∂rnek cevap iskeleti.",
   prompt:`G√∂rev: [pozisyon] i√ßin 6 m√ºlakat sorusu ve her biri i√ßin g√º√ßl√º bir cevap iskeleti olu≈ütur. STAR y√∂ntemi √∂ner.`},

  {id:"code_review", ic:"üß™", title:"Kod ƒ∞ncelemesi (JS)", desc:"Risk, performans, temizlik; kƒ±sa PR yorumu.",
   prompt:`Task: Review the following JavaScript code. Output:
1) Bugs & risks 2) Performance 3) Readability 4) Suggested patch (short).
Code:\n[code here]`},

  {id:"sql", ic:"üóÇÔ∏è", title:"SQL Sorgusu Yaz", desc:"≈ûema‚Üísorgu + kƒ±sa a√ßƒ±klama.",
   prompt:`G√∂rev: A≈üaƒüƒ±daki tablo ≈üemasƒ±na g√∂re istenen sonucu getiren SQL yaz ve kƒ±saca a√ßƒ±kla.\n≈ûema: [schema]\nƒ∞stek: [query]`},

  {id:"excel", ic:"üìä", title:"Excel Form√ºl√º", desc:"√ñrnekle a√ßƒ±kla + 2 varyant.",
   prompt:`G√∂rev: Excel/Google Sheets form√ºl√º yaz. √ñrnek ver ve iki varyant √∂ner.\nƒ∞stek: [√∂r: sipari≈ü tarihi son 30 g√ºn ve tutar>500 filtre]`},

  {id:"contract_sum", ic:"üìÑ", title:"S√∂zle≈üme √ñzetle (UYARI)", desc:"Kritik maddeler + risk; hukuki tavsiye vermeden.",
   prompt:`UYARI: Hukuki tavsiye verme. G√∂rev: A≈üaƒüƒ±daki s√∂zle≈ümeyi 1 sayfada √∂zetle.
√áƒ±ktƒ±: 1) Taraflar/s√ºre 2) √úcret/teslim 3) Sorumluluklar 4) Fesih 5) Uyu≈ümazlƒ±k 6) Risk notu.`},

  {id:"meeting_notes", ic:"üìù", title:"Toplantƒ± Notu ‚Üí √ñzet", desc:"Kararlar, aksiyonlar, sahipler, tarihler.",
   prompt:`G√∂rev: A≈üaƒüƒ±daki ham notlardan kararlarƒ±, aksiyonlarƒ± (sahip/tarih) ve a√ßƒ±k sorularƒ± √ßƒ±kar; tabloyla ver.\nNotlar: [yapƒ±≈ütƒ±r]`},

  {id:"simplify", ic:"ü´ß", title:"Metni Basitle≈ütir", desc:"B1 seviyesine indir, √∂rnekle a√ßƒ±kla.",
   prompt:`G√∂rev: Metni B1 seviyesine basitle≈ütir. 1 √∂rnek ve 3 maddeyle √∂zet ekle.\nMetin: [yapƒ±≈ütƒ±r]`},

  {id:"tr2en", ic:"üåê", title:"TR ‚Üí EN √áeviri", desc:"Doƒüal ton, kƒ±sa a√ßƒ±klama notu.",
   prompt:`Task: Translate Turkish ‚Üí English. Keep tone natural; add a short note if there are cultural nuances.\nText: [paste]`},

  {id:"en2tr", ic:"üåç", title:"EN ‚Üí TR √áeviri", desc:"Doƒüal, akƒ±cƒ±, baƒülamsal.",
   prompt:`G√∂rev: ƒ∞ngilizce ‚Üí T√ºrk√ße √ßeviri yap. Doƒüal ve akƒ±cƒ± ol; baƒülam notu ekle.\nMetin: [yapƒ±≈ütƒ±r]`},

  {id:"teacher_grammar", ic:"üìö", title:"Gramer Konusu Anlat", desc:"Konu ‚Üí a√ßƒ±klama + √∂rnek + mini test.",
   prompt:`G√∂rev: [konu: √∂r. Present Perfect] konusunu a√ßƒ±kla. Yapƒ±: Kural ‚Üí 3 √∂rnek ‚Üí 5 soruluk mini test (cevap anahtarƒ± ayrƒ±).`}
];

/* ============= Etiketleri √áiz ============= */
function renderTags(){
  const q = (searchInput.value||"").toLowerCase();
  const favs = new Set(getFavs());
  const data = TAGS.filter(t => {
    const hay = (t.title+" "+t.desc).toLowerCase();
    const passQ = !q || hay.includes(q);
    const passFav = !state.showingFavs || favs.has(t.id);
    return passQ && passFav;
  });

  grid.innerHTML = "";
  for(const t of data){
    const el = document.createElement("div");
    el.className = "tag";
    el.dataset.id = t.id;
    el.innerHTML = `
      <div class="ic">${t.ic}</div>
      <div class="txt">
        <div class="title">${esc(t.title)}</div>
        <p class="desc">${esc(t.desc)}</p>
      </div>
      <button class="fav ${getFavs().includes(t.id)?"active":""}" title="Favori">‚≠ê</button>
    `;
    // click to send; Alt+click to edit
    el.addEventListener("click", (e)=>{
      if(e.target.classList.contains("fav")) return;
      if(e.altKey){
        input.value = t.prompt;
        input.focus();
      }else{
        sendTemplate(t.prompt, t.title);
      }
    });
    el.querySelector(".fav").addEventListener("click", (e)=>{
      e.stopPropagation(); toggleFav(t.id);
    });
    grid.appendChild(el);
  }
}
searchInput.addEventListener("input", renderTags);
favBtn.addEventListener("click", ()=>{
  state.showingFavs = !state.showingFavs;
  favBtn.textContent = state.showingFavs ? "‚≠ê Yalnƒ±z Favoriler" : "‚≠ê Favoriler";
  renderTags();
});

/* ============= Sohbet ============= */
function buildPrompt(messages){
  return messages.map(m => `${m.role.toUpperCase()}: ${m.content}`).join("\n\n");
}

async function query(model, inputStr){
  const key = getKey();
  if(!key || !key.startsWith("sk-")){
    addMsg("assistant","‚ö†Ô∏è API anahtarƒ±nƒ± ayarla: √ústte <strong>API Anahtarƒ±</strong> butonuna tƒ±kla.","Anahtar yok");
    return;
  }
  showTyping(); sendBtn.disabled = true; input.disabled = true;

  try{
    // 1) Responses API (√∂nerilen)
    const body1 = {
      model,
      input: inputStr,
      max_output_tokens: 500
    };
    const r1 = await fetch("https://api.openai.com/v1/responses",{
      method:"POST",
      headers:{ "Authorization":"Bearer "+key.trim(), "Content-Type":"application/json" },
      body: JSON.stringify(body1)
    });

    let ok=false, text="";
    if(r1.ok){
      const data = await r1.json().catch(()=>null);
      text = data?.output_text ||
             data?.output?.[0]?.content?.[0]?.text?.value || "";
      ok = !!text.trim();
    }else{
      // log (sessiz)
      await r1.text().catch(()=>{});
    }

    // 2) Fallback: Chat Completions
    if(!ok){
      const msgs = state.messages.map(m=>({role:m.role, content:m.content}));
      const r2 = await fetch("https://api.openai.com/v1/chat/completions", {
        method:"POST",
        headers:{ "Authorization":"Bearer "+key.trim(), "Content-Type":"application/json" },
        body: JSON.stringify({ model, messages: msgs, max_tokens: 500 })
      });
      if(r2.ok){
        const d = await r2.json().catch(()=>null);
        text = d?.choices?.[0]?.message?.content || "";
        ok = !!text.trim();
      }
    }

    hideTyping();
    if(ok){
      addMsg("assistant", mdLite(text), text);
      state.messages.push({ role:"assistant", content:text });
    }else{
      addMsg("assistant","(bo≈ü yanƒ±t) ‚Äî L√ºtfen tekrar dener misin?", "(bo≈ü yanƒ±t)");
    }
  }catch(err){
    hideTyping();
    addMsg("assistant","‚ö†Ô∏è Aƒü/istemci hatasƒ±: "+(err.message||err), String(err));
  }finally{
    sendBtn.disabled=false; input.disabled=false; input.focus();
  }
}

function sendTemplate(tpl, title="Etiket"){
  const systemText = (systemInput.value||"T√ºrk√ße konu≈ü; net, kƒ±sa; gerekiyorsa tablo/ba≈ülƒ±k kullan.");
  if(state.messages.length===0 && systemText){
    state.messages.push({ role:"system", content: systemText });
  }
  const final = `# Etiket: ${title}\n\n${tpl}`;
  addMsg("user", mdLite(final), final);
  state.messages.push({ role:"user", content: final });
  const inputStr = buildPrompt(state.messages);
  query(modelSel.value, inputStr);
}

/* Kullanƒ±cƒ± serbest metin g√∂nderirse */
input.addEventListener("keydown", e=>{
  if(e.key==="Enter" && !e.shiftKey){ e.preventDefault(); form.requestSubmit(); }
});
form.addEventListener("submit", e=>{
  e.preventDefault();
  const txt = input.value.trim(); if(!txt) return; input.value="";
  const systemText = (systemInput.value||"T√ºrk√ße konu≈ü; net, kƒ±sa; gerekiyorsa tablo/ba≈ülƒ±k kullan.");
  if(state.messages.length===0 && systemText){
    state.messages.push({ role:"system", content: systemText });
  }
  addMsg("user", mdLite(txt), txt);
  state.messages.push({ role:"user", content: txt });
  const inputStr = buildPrompt(state.messages);
  query(modelSel.value, inputStr);
});

/* ============= API Key Modal ============= */
function openModal(){ modal.classList.add("show"); keyInput.value=getKey(); keyInput.focus(); }
function closeModal(){ modal.classList.remove("show"); }
keyBtn.onclick = openModal; cancelKeyBtn.onclick = closeModal;
saveKeyBtn.onclick = ()=>{ const v = keyInput.value; setKey(v); if(!getKey().startsWith("sk-")) alert("Anahtar sk- ile ba≈ülamƒ±yor olabilir. Yine de kaydedildi."); closeModal(); }
keyInput.addEventListener("keydown", e=>{ if((e.key==="Enter")&&(e.metaKey||e.ctrlKey)) saveKeyBtn.click(); });

/* ============= Clear & Init ============= */
clearBtn.onclick = ()=>{ state.messages=[]; chat.innerHTML=""; addMsg("assistant","Sohbet temizlendi. Soldan bir etikete tƒ±klayƒ±p ba≈ülayabilirsin. ‚ú®"); };
addMsg("assistant","Hazƒ±r etiketlerden birine tƒ±klayarak ba≈ülayabilirsin. `Alt + tƒ±k` ile metni √∂nce d√ºzenleyebilirsin.");
renderTags();

// ƒ∞lk kullanƒ±mda anahtar sor
if(!getKey()) openModal();
</script>
</body>
</html>
